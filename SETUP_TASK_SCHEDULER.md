# Windowsタスクスケジューラ設定手順

## 📋 概要

Windowsタスクスケジューラを使用して、以下の3つのスクリプトを自動実行します：

1. **ニュース収集** (`run_fetch_news.bat`) - 毎日1回
2. **コンテンツ生成** (`run_content_generator.bat`) - 1日2回
3. **ステータス更新** (`run_status_automation.bat`) - 毎時1回

⚠️ **注意**: PCが**起動している時のみ実行**されます。PCがオフの場合は次回起動時に実行されません。

---

## 🚀 セットアップ手順

### タスク1: ニュース自動収集（毎日JST 9:00実行）

#### 1. タスクスケジューラを開く

- Windowsキー + R → `taskschd.msc` と入力 → Enter

#### 2. 基本タスクの作成

1. 右側の「操作」パネル → **「基本タスクの作成」** をクリック
2. **名前**: `医療政策ニュース自動収集`
3. **説明**: `厚生労働省とHGPIから最新ニュースを取得してNotionに追加`
4. **次へ**をクリック

#### 3. トリガーの設定

1. **毎日** を選択
2. **次へ**をクリック
3. **開始日時**: 今日の日付、時刻は **09:00:00**
4. **次へ**をクリック

#### 4. 操作の設定

1. **プログラムの開始** を選択
2. **次へ**をクリック
3. 以下を入力:
   - **プログラム/スクリプト**: 
     ```
     C:\Users\jumpd\OneDrive\Documents\Obsidian_Main\health-policy-watcher\run_fetch_news.bat
     ```
   - **開始**: 
     ```
     C:\Users\jumpd\OneDrive\Documents\Obsidian_Main\health-policy-watcher
     ```
4. **次へ**をクリック
5. **完了**をクリック

#### 5. 詳細設定（重要）

1. タスクスケジューラの左側パネル → **「タスク スケジューラ ライブラリ」**
2. 作成したタスク **「医療政策ニュース自動収集」** を右クリック → **「プロパティ」**
3. **「全般」タブ**:
   - ☑ **「ユーザーがログオンしているかどうかにかかわらず実行する」** をチェック（オプション）
   - ☑ **「最上位の特権で実行する」** をチェック（オプション）
4. **「条件」タブ**:
   - ☑ **「タスクを実行するためにスリープを解除する」** をチェック（推奨）
   - ☐ **「コンピューターをAC電源で使用している場合のみタスクを開始する」** のチェックを外す
5. **「設定」タブ**:
   - ☑ **「タスクが失敗した場合の再起動の間隔」**: 10分、最大3回（オプション）
6. **OK**をクリック

---

### タスク2: コンテンツ自動生成（1日2回: JST 10:00, 22:00実行）

#### 手順（タスク1と同様）

1. **名前**: `医療政策コンテンツ自動生成`
2. **説明**: `NotionDBを監視してブログ記事とPodcast台本を自動生成`
3. **トリガー**: 毎日
4. **開始時刻**: **10:00:00**
5. **プログラム**: 
   ```
   C:\Users\jumpd\OneDrive\Documents\Obsidian_Main\health-policy-watcher\run_content_generator.bat
   ```
6. **開始**: 
   ```
   C:\Users\jumpd\OneDrive\Documents\Obsidian_Main\health-policy-watcher
   ```

#### 追加トリガー（2回目の実行: 22:00）

1. タスクのプロパティを開く
2. **「トリガー」タブ**
3. **「新規」**ボタンをクリック
4. **毎日**を選択
5. **開始時刻**: **22:00:00**
6. **OK**をクリック

---

### タスク3: ステータス自動更新（1時間ごと実行）

#### 手順

1. **名前**: `Notionステータス自動更新`
2. **説明**: `Notionのステータスと日付を自動更新`
3. **トリガー**: 毎日
4. **開始時刻**: **00:00:00**（深夜0時）
5. **プログラム**: 
   ```
   C:\Users\jumpd\OneDrive\Documents\Obsidian_Main\health-policy-watcher\run_status_automation.bat
   ```
6. **開始**: 
   ```
   C:\Users\jumpd\OneDrive\Documents\Obsidian_Main\health-policy-watcher
   ```

#### トリガーを1時間ごとに変更

1. タスクのプロパティを開く
2. **「トリガー」タブ** → 既存のトリガーを編集
3. **「詳細設定」**セクション:
   - ☑ **「繰り返し間隔」**: **1時間**
   - **継続時間**: **1日**
4. **OK**をクリック

---

## ✅ 動作確認

### 手動テスト

各バッチファイルをダブルクリックして、正常に動作するか確認：

1. `run_fetch_news.bat` → ニュース取得ログが表示される
2. `run_content_generator.bat` → コンテンツ生成ログが表示される
3. `run_status_automation.bat` → ステータス更新ログが表示される

### タスクスケジューラからテスト実行

1. タスクスケジューラでタスクを右クリック
2. **「実行する」**をクリック
3. ログファイルを確認（`fetch_news.log`, `notion_content_generator.log`, `notion_automation.log`）

---

## 📊 自動実行スケジュール

| タスク名 | 実行頻度 | 実行時刻 | 処理内容 |
|---------|---------|---------|---------|
| **医療政策ニュース自動収集** | 毎日1回 | JST 9:00 | MHLW/HGPIからニュース取得 |
| **医療政策コンテンツ自動生成** | 1日2回 | JST 10:00, 22:00 | PDF/URLからコンテンツ生成 |
| **Notionステータス自動更新** | 1時間ごと | 毎時0分 | ステータスと日付の自動更新 |

---

## 🔧 トラブルシューティング

### タスクが実行されない

**確認事項**:
1. PCが起動しているか
2. タスクスケジューラでタスクが「有効」になっているか
3. 「最後の実行結果」が `0x0`（成功）か

### バッチファイルをダブルクリックしてもすぐ閉じる

**原因**: エラーが発生している

**対策**: 
1. バッチファイルを右クリック → **「編集」**
2. 最後の `pause` を確認（エラーメッセージが表示されるはず）

### パスが見つからないエラー

**確認事項**: バッチファイル内のパスが正しいか確認

---

## 💡 Tips

### ログファイルの確認

各スクリプトは以下のログファイルに実行結果を記録します：

```
health-policy-watcher/
├── fetch_news.log                   # ニュース収集ログ
├── notion_content_generator.log     # コンテンツ生成ログ
├── notion_automation.log            # ステータス更新ログ
├── run_fetch_news.log              # バッチ実行ログ
├── run_content_generator.log       # バッチ実行ログ
└── run_status_automation.log       # バッチ実行ログ
```

### タスクの一時停止

旅行や長期不在時は、タスクを一時停止できます：

1. タスクを右クリック → **「無効にする」**
2. 再開時: 右クリック → **「有効にする」**

---

## ✅ セットアップ完了チェックリスト

- [ ] 3つのタスクをタスクスケジューラに登録
- [ ] 各タスクの「次回の実行時刻」が正しく表示される
- [ ] バッチファイルの手動実行が成功する
- [ ] ログファイルにエラーが記録されていない
- [ ] 生成されたファイルが `_Output/blog/`, `_Output/script/` に保存される

すべてチェックできたら、自動化完了です！🎉

---

## 📞 補足情報

### GitHub Actionsとの使い分け

- **GitHub Actions** (PCオフでも実行):
  - ✅ ニュース収集 (`fetch_news.yml`) ← こちらはGitHub Actionsのまま推奨
  - ✅ ステータス更新 (`notion_automation.yml`) ← こちらもGitHub Actionsのまま推奨

- **Windowsタスクスケジューラ** (PCオン時のみ):
  - ✅ コンテンツ生成 (`run_content_generator.bat`) ← ローカルファイル保存が必要

**推奨構成**: GitHub Actions（ニュース収集・ステータス更新） + Windowsタスクスケジューラ（コンテンツ生成）
